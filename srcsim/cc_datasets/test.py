import numpy as np
from matplotlib import pyplot as plt
from scipy.fft import fft, fftfreq, ifft

fft_output_file = 'just_fft_tb_out.txt' # output generated by the FFT IP core

N = 256 # 256 data points
N_half = 128
Fs = 446000 # ADC sample frequency, no decimation
prop_zeros=0.25 # determines number of 0s in trigger.data and trigger_lshift.data
right_shift = 16 # number of points to left shift trigger_lshift.data by

t_step = (1/Fs)
freq = 30000
t = np.arange(N)

raw_cos = 0.5 * np.cos(2*np.pi * freq * t * t_step ) + 0.5 # generate sine wave
cos_floats = raw_cos*1023
cos_ints = np.rint(cos_floats).astype(int)
num_zeros = int(prop_zeros * N)
num_data = N - num_zeros
data = np.append(np.zeros(num_zeros) + 511, cos_ints[0:num_data]).astype(int)

zero_padded = np.append(np.zeros(N_half), data[0:N_half])

ifft_control = ifft(fft(zero_padded))
plt.subplot(311)
plt.plot(ifft_control)

fft_out = np.loadtxt(fft_output_file)
fft_out_comp = fft_out[0::2] + 1j*fft_out[1::2]

ifft_out = ifft(fft_out_comp)
plt.subplot(312)
plt.plot(ifft_out)
plt.show()